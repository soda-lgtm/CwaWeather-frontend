<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rena çš„æ°£è±¡ç´ ææœ¬</title>
    <link rel="icon" type="image/png" href="./icon-v2.png">
    <link rel="apple-touch-icon" href="./icon-v2.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
        rel="stylesheet">

 <style>
 /* [CSS å€å¡Šæ’æ§½] Root Variables */
:root {
    /* æ°´å½©ç²‰éœ§è‰²ç³» */
    --paper-bg: #F9F7F2; /* æš–ç±³ç™½ç´™å¼µè‰² */
    --paper-texture: #EFEDE8;
    
    --pencil-line: #5E5045; /* è‰²é‰›ç­†æ·±è¤è‰² */
    --pencil-gray: #8C8279;
    
    --wc-pink: #F2D5D5; /* æ¸²æŸ“ç²‰ */
    --wc-blue: #C5DEE8; /* æ¸²æŸ“è— */
    --wc-green: #D1E2C8; /* æ¸²æŸ“ç¶  */
    --wc-yellow: #FBECC6; /* æ¸²æŸ“é»ƒ */
    
    --font-main: 'Zen Maru Gothic', sans-serif;
}

/* [CSS å€å¡Šæ’æ§½] Global Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: var(--font-main);
    color: var(--pencil-line);
    min-height: 100vh;
    overflow-x: hidden;
    padding-bottom: 30px;

    /* åŸºç¤åº•è‰² */
    background-color: var(--paper-bg); 
    
    /* === ç´™å¼µç´‹ç†èƒŒæ™¯åœ–é›†æˆ (è«‹ç¢ºä¿åœ–ç‰‡æª”åç‚º paper-bg.jpg) === */
    background-image: url('./paper-bg.jpg');
    
    /* é‡å° 1080x1920 ç›´å¼åœ–ç‰‡çš„æœ€ä½³åŒ–è¨­å®š */
    background-size: cover;      /* è®“åœ–ç‰‡å……æ»¿æ•´å€‹è¢å¹• */
    background-position: center top; /* å±…ä¸­å°é½Š */
    background-attachment: fixed;/* èƒŒæ™¯å›ºå®šä¸éš¨æ²å‹•ï¼Œç‡Ÿé€ ç•«åœ¨ç´™ä¸Šçš„æ„Ÿè¦º */
    background-repeat: no-repeat;
    /* ========================================================= */

}

/* [CSS å€å¡Šæ’æ§½] Layout Components */

/* é ‚éƒ¨å°èˆªï¼šæ¨¡æ“¬ç´™è† å¸¶æˆ–æ‰‹å¸³æ¨™é¡Œ */
.status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 25px;
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(249, 247, 242, 0.9); /* åŠé€æ˜ç´™å¼µæ„Ÿ */
    backdrop-filter: blur(5px);
    border-bottom: 2px dashed #E0DCD0; /* è™›ç·šæ’•ç—• */
}

.location-pill {
    font-size: 1.4rem;
    font-weight: 900;
    color: var(--pencil-line);
    display: flex;
    align-items: center;
    gap: 5px;
}

/* æ‰‹ç¹ªåœˆåœˆæ•ˆæœ */
.location-pill::before {
    content: "ğŸ“";
    filter: sepia(0.5);
}

.update-pill {
    font-size: 0.85rem;
    color: var(--pencil-gray);
    font-weight: 700;
    background: var(--wc-yellow);
    padding: 5px 12px;
    /* æ‰‹ç¹ªä¸è¦å‰‡é‚Šæ¡† Radius */
    border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
    border: 2px solid var(--pencil-line);
    transform: rotate(2deg); /* å¾®å¾®æ­ªæ–œçš„æ‰‹ä½œæ„Ÿ */
}

.container {
    padding: 25px;
    max-width: 500px;
    margin: 0 auto;
}

/* === æ ¸å¿ƒï¼šä»Šæ—¥ç„¦é»å¡ç‰‡ (æ‰‹ç¹ªç´ ææœ¬é¢¨æ ¼) === */
.hero-card {
    background: white;
    /* ç¨å¾®ä¸è¦å‰‡çš„æ–¹æ¡† */
    border-radius: 20px 25px 22px 28px;
    padding: 30px 20px;
    text-align: center;
    position: relative;
    margin-bottom: 40px;
    margin-top: 10px;
    
    /* è‰²é‰›ç­†é‚Šæ¡†è³ªæ„Ÿ */
    border: 3px solid var(--pencil-line);
    box-shadow: 
        8px 8px 0 var(--wc-blue), /* éŒ¯ä½è‰²å¡Š */
        8px 8px 0 3px var(--pencil-line); /* è‰²å¡Šé‚Šæ¡† */
}

/* ç´™è† å¸¶è£é£¾ */
.hero-card::before {
    content: '';
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%) rotate(-1deg);
    width: 120px;
    height: 35px;
    background: rgba(242, 213, 213, 0.6); /* åŠé€æ˜è† å¸¶ */
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    z-index: 1;
}

.hero-period {
    font-size: 1.2rem;
    font-weight: 900;
    color: var(--pencil-line);
    margin-bottom: 5px;
    position: relative;
    z-index: 2;
}

.hero-temp-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin: 20px 0;
}

.hero-icon {
    font-size: initial; /* ç”¨åœ–ç‰‡å°ºå¯¸æ§åˆ¶ */
    filter: none; /* ç§»é™¤ Emoji æ¿¾é¡ */
    animation: float 4s ease-in-out infinite;

}

@keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-8px) rotate(2deg); }
}

.hero-temp {
    font-size: 4.8rem;
    font-weight: 900;
    color: var(--pencil-line);
    line-height: 1;
    /* æ¨¡æ“¬è‰²é‰›ç­†å¡«è‰²ä¸å‡ */
    background: linear-gradient(180deg, var(--pencil-line) 20%, #7d6b5d 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.hero-desc {
    font-size: 1.6rem;
    color: var(--pencil-gray);
    font-weight: 700;
    margin-bottom: 25px;
    letter-spacing: 2px;
}

/* === å»ºè­°å€ï¼šæ‹ç«‹å¾—/ä¾¿åˆ©è²¼é¢¨æ ¼ === */
.advice-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 25px;
}

.advice-item {
    background: var(--paper-bg);
    padding: 15px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    border: 2px solid var(--pencil-line);
    /* ä¸è¦å‰‡åœ“è§’ */
    border-radius: 15px 255px 15px 255px / 255px 15px 225px 15px;
}

/* å·¦é‚Šç²‰è‰²ï¼Œå³é‚Šç¶ è‰² */
.advice-item:nth-child(1) { background: var(--wc-pink); transform: rotate(-2deg); }
.advice-item:nth-child(2) { background: var(--wc-green); transform: rotate(2deg); }

.advice-icon {
    font-size: 2.2rem; /* ç‚º Emoji é ç•™ï¼Œä½†åœ–ç‰‡æœƒè¦†è“‹ */
    margin-bottom: 8px;
    filter: drop-shadow(2px 2px 0 rgba(255,255,255,0.5));
}

.advice-text {
    font-size: 1.2rem;
    font-weight: 900;
    color: var(--pencil-line);
    margin-bottom: 4px;
}

.advice-sub {
    font-size: 0.8rem;
    font-weight: 700;
    color: rgba(94, 80, 69, 0.7);
}

/* === ç¨å¾Œé å ±ï¼šæ°´å½©ç­†è§¸æ¨™é¡Œ === */
.section-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding-left: 10px;
}

.section-title {
    font-size: 1.4rem;
    color: var(--pencil-line);
    font-weight: 900;
    position: relative;
    z-index: 1;
}

/* æ¨™é¡Œåº•ä¸‹çš„è¢å…‰ç­†ç—•è·¡ */
.section-title::after {
    content: '';
    position: absolute;
    bottom: 2px;
    left: -5px;
    right: -5px;
    height: 12px;
    background: var(--wc-yellow);
    z-index: -1;
    border-radius: 10px;
    opacity: 0.8;
    transform: rotate(-1deg);
}

.scroll-container {
    display: flex;
    overflow-x: auto;
    gap: 20px;
    padding: 10px 10px 30px 10px;
    scrollbar-width: none;
}

.scroll-container::-webkit-scrollbar { display: none; }

.mini-card {
    min-width: 130px;
    background: white;
    border: 2px solid var(--pencil-line);
    border-radius: 18px;
    padding: 15px;
    text-align: center;
    flex-shrink: 0;
    position: relative;
}

/* ä½¿ç”¨å½å…ƒç´ è£½ä½œä¸Šæ–¹è† å¸¶ */
.mini-card::before {
    content: '';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 20px;
    background: rgba(197, 222, 232, 0.8); /* è—è‰²è† å¸¶ */
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

.mini-time {
    color: var(--pencil-gray);
    font-size: 0.9rem;
    font-weight: 700;
    margin-bottom: 8px;
    margin-top: 5px;
}

.mini-icon {
    font-size: 2.2rem;
    margin: 5px 0;
}

.mini-temp {
    font-size: 1.1rem;
    font-weight: 900;
    color: var(--pencil-line);
}

/* [CSS å€å¡Šæ’æ§½] Loading Screen */
.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--paper-bg);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 999;
}

.loading-text {
    margin-top: 20px;
    color: var(--pencil-line);
    font-weight: 900;
    font-size: 1.2rem;
    letter-spacing: 2px;
}

/* è®“å¤©æ°£åœ–ç‰‡èƒ½å¤ å®Œç¾æ›¿ä»£åŸæœ¬çš„ Emoji */
.weather-img {
    width: 5.5rem !important; /* ç¢ºä¿ Hero Card åœ–ç¤ºå¤ å¤§ */
    height: 5.5rem !important;
    object-fit: contain;
    margin: 0 auto;
    /* è¦†å¯«æ‰åŸæœ¬ emoji çš„ display: block */
    display: block; 
}

/* è®“ mini-card è£¡çš„åœ–ç‰‡å°ºå¯¸ç¸®å° */
.mini-card .weather-img {
    width: 2.5rem !important;
    height: 2.5rem !important;
    margin: 5px auto;
}

/* æ–°å¢çš„ advice åœ–ç‰‡æ¨£å¼ */
.advice-img {
    width: 2.2rem; /* åŒ¹é… .advice-icon çš„ font-size */
    height: 2.2rem;
    object-fit: contain;
    filter: drop-shadow(2px 2px 0 rgba(255,255,255,0.5)); /* ç¹¼æ‰¿åŸæœ¬çš„é™°å½± */
}


    </style>
</head>

<body>
    <div id="loading" class="loading-screen">
        <div style="font-size: 5rem; animation: float 2s infinite;">ğŸ¨</div>
        <p class="loading-text">Rena æ­£åœ¨ç•«å¤©æ°£åœ–...</p>
    </div>

    <div class="status-bar">
        <div class="location-pill">è‡ºåŒ—ï¼šä»Šæ—¥é¢¨æ™¯</div>
        <div id="updateTime" class="update-pill">Loading...</div>
    </div>

    <div class="container" id="mainContent" style="display: none;">

        <div id="heroCard">
            </div>

        <div class="section-header">
            <h3 class="section-title">ç¨å¾Œé å ±</h3>
        </div>
        <div class="scroll-container" id="futureForecasts">
            </div>

    </div>

    <script>
        const API_URL = "https://weather-tp.zeabur.app/api/weather/kaohsiung";



        function getWeatherIcon(weather) {
    
            const imgClass = 'class="hero-icon weather-img"'; 
    

            if (!weather) return `<img src="./icon-sunny.png" ${imgClass}>`; 
            if (weather.includes("æ™´")) return `<img src="./icon-sunny.png" ${imgClass}>`;
            if (weather.includes("å¤šé›²")) return `<img src="./icon-cloudy-sun.png" ${imgClass}>`;
            if (weather.includes("é™°")) return `<img src="./icon-cloudy.png" ${imgClass}>`;
            if (weather.includes("é›¨")) return `<img src="./icon-rain.png" ${imgClass}>`;
            if (weather.includes("é›·")) return `<img src="./icon-thunder.png" ${imgClass}>`;
            
            return `<img src="./icon-sunny.png" ${imgClass}>`; 
        }



 function getAdvice(rainProb, maxTemp) {
            const imgClass = 'class="advice-img"'; // ç‚ºå»ºè­°å€åœ–ç‰‡å®šç¾©æ¨£å¼
            let rainIcon = `<img src="./icon-no-umbrella.png" ${imgClass}>`; // é è¨­ç‚ºä¸å¸¶å‚˜
            let rainText = "æ”¾å¿ƒå‡ºé–€å•¦";
            if (parseInt(rainProb) > 30) {
                rainIcon = `<img src="./icon-umbrella.png" ${imgClass}>`; // å¸¶å‚˜
                rainText = "å¸¶æŠŠå‚˜å¥½å–”";
            }

            let clothIcon = `<img src="./icon-tshirt.png" ${imgClass}>`; // é è¨­çŸ­è¢–
            let clothText = "ç©¿é€™æ¨£å‰›å¥½";
            if (parseInt(maxTemp) >= 28) {
                clothIcon = `<img src="./icon-sleeveless.png" ${imgClass}>`; // èƒŒå¿ƒ
                clothText = "èƒŒå¿ƒæœ€æ¶¼å¿«";
            } else if (parseInt(maxTemp) <= 20) {
                clothIcon = `<img src="./icon-coat.png" ${imgClass}>`; // å¤–å¥—
                clothText = "ç©¿æš–æš–å†èµ°";
            }

            return { rainIcon, rainText, clothIcon, clothText };
        }

        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "æ—©å®‰æ—©æ™¨";
            if (hour >= 11 && hour < 14) return "åˆé¤æ™‚é–“";
            if (hour >= 14 && hour < 18) return "åˆå¾Œæ™‚å…‰";
            if (hour >= 18 && hour < 23) return "æ™šå®‰å¤œæ™š";
            return "ç¡è¦ºæ™‚é–“";
        }

        function renderWeather(data) {
            const forecasts = data.forecasts;
            const current = forecasts[0];
            const others = forecasts.slice(1);

            const advice = getAdvice(current.rain, current.maxTemp);
            const period = getTimePeriod(current.startTime);
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

            // [JS å€å¡Šæ’æ§½] Render Hero
            document.getElementById('heroCard').innerHTML = `
                <div class="hero-card">
                    <div class="hero-period">${period}</div>
                    <div class="hero-temp-container">
                        <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                        <div class="hero-temp">${avgTemp}Â°</div>
                    </div>
                    <div class="hero-desc">${current.weather}</div>
                    
                    <div class="advice-grid">
                        <div class="advice-item">
                            <div class="advice-icon">${advice.rainIcon}</div>
                            <div class="advice-text">${advice.rainText}</div>
                            <div class="advice-sub">é™é›¨ç‡ ${current.rain}</div>
                        </div>
                        <div class="advice-item">
                            <div class="advice-icon">${advice.clothIcon}</div>
                            <div class="advice-text">${advice.clothText}</div>
                            <div class="advice-sub">æœ€é«˜æº« ${current.maxTemp}Â°</div>
                        </div>
                    </div>
                </div>
            `;

            // [JS å€å¡Šæ’æ§½] Render List
            const scrollContainer = document.getElementById('futureForecasts');
            scrollContainer.innerHTML = '';
            const todayDate = new Date().getDate();

            others.forEach(f => {
            let p = getTimePeriod(f.startTime);
            const fDate = new Date(f.startTime);
             if (fDate.getDate() !== todayDate) {
            p = "æ˜å¤© " + p.replace("æ—©å®‰","").replace("æ™šå®‰",""); 
            } else {
            p = p.replace("æ—©å®‰","").replace("æ™šå®‰","");
            }


            const rainDropletIcon = '<img src="./icon-droplet.png" style="width:16px; height:16px; vertical-align:middle; margin-right:3px;">';

            scrollContainer.innerHTML += `
            <div class="mini-card">
            <div class="mini-time">${p}</div>
            <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
            <div class="mini-temp">${f.minTemp}Â° ~ ${f.maxTemp}Â°</div>
            <div style="font-size:0.8rem; color:#8C8279; margin-top:5px; font-weight:700;">${rainDropletIcon}${f.rain}</div>
           </div>
         `;
            });
            // æ›´æ–°æ™‚é–“é¡¯ç¤º
            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const dayIndex = now.getDay();
            const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
            document.getElementById('updateTime').textContent = `${month}/${date} ${days[dayIndex]}`;
        }

        async function fetchWeather() {
            try {
                const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
                const fetchPromise = fetch(API_URL).then(res => res.json());
                const [_, json] = await Promise.all([delayPromise, fetchPromise]);

                if (json.success) {
                    renderWeather(json.data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } else {
                    throw new Error("API Error");
                }
            } catch (e) {
                console.error(e);
                alert("å“å‘€ï¼ç•«ç­†æ‰¾ä¸åˆ°ç¶²è·¯äº†...");
            }
        }

        document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
</body>

</html>